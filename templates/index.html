<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Tickets 2026</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        header { text-align: center; color: white; margin-bottom: 40px; }
        header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .section { background: white; margin: 20px 0; padding: 30px; border-radius: 15px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); }
        .events-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-top: 20px; }
        .event-card { background: #f8f9ff; padding: 20px; border-radius: 12px; border-left: 4px solid #667eea; cursor: pointer; transition: all 0.3s; }
        .event-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 12px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 16px; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; width: 100%; }
        button:hover { transform: translateY(-2px); }
        .success { background: #d4edda; color: #155724; padding: 15px; border-radius: 8px; margin-top: 20px; display: none; align-items: center; gap: 10px; }
        @media (max-width: 768px) { header h1 { font-size: 2rem; } .container { padding: 10px; } }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-ticket-alt"></i> Event Tickets 2026</h1>
            <p>Book your tickets for amazing events!</p>
        </header>

        <div class="section">
            <h2><i class="fas fa-calendar"></i> Upcoming Events</h2>
            <div id="events-list" class="events-grid"></div>
        </div>

        <div class="section">
            <h2><i class="fas fa-shopping-cart"></i> Book Tickets</h2>
            <form id="ticket-form">
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Full Name</label>
                    <input type="text" name="name" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-calendar-alt"></i> Select Event</label>
                    <select id="event-select" name="eventId" required>
                        <option value="">Loading events...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-tickets-alt"></i> Tickets</label>
                    <input type="number" name="tickets" min="1" max="10" value="1" required>
                </div>
                <button type="submit"><i class="fas fa-credit-card"></i> Book Now</button>
            </form>
            <div id="success-message" class="success">
                <i class="fas fa-check-circle"></i> Booking confirmed! üé´
            </div>
        </div>
    </div>

    <script>
        console.log("üî• Page loaded!");
        
        async function loadEvents() {
            console.log("üöÄ Fetching events...");
            try {
                const response = await fetch('/api/events');
                const events = await response.json();
                console.log("‚úÖ Events:", events);
                
                const eventsList = document.getElementById('events-list');
                const eventSelect = document.getElementById('event-select');
                
                eventsList.innerHTML = '';
                eventSelect.innerHTML = '<option value="">Select an event...</option>';
                
                events.forEach(event => {
                    // Event cards
                    const card = document.createElement('div');
                    card.className = 'event-card';
                    card.innerHTML = `
                        <h3>${event.name}</h3>
                        <div><i class="fas fa-calendar"></i> ${event.date}</div>
                        <div><i class="fas fa-users"></i> ${event.available} tickets left</div>
                    `;
                    eventsList.appendChild(card);
                    
                    // Dropdown
                    const option = document.createElement('option');
                    option.value = event.id;
                    option.textContent = `${event.name} - ${event.date}`;
                    eventSelect.appendChild(option);
                });
                console.log("üéâ Events loaded!");
            } catch (error) {
                console.error("‚ùå Error:", error);
                document.getElementById('event-select').innerHTML = '<option value="">Error loading events</option>';
            }
        }
        
        document.getElementById('ticket-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            
            try {
                const response = await fetch('/book', { method: 'POST', body: formData });
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('success-message').style.display = 'flex';
                    this.reset();
                    this.querySelector('input[name="tickets"]').value = '1';
                    setTimeout(() => document.getElementById('success-message').style.display = 'none', 5000);
                }
            } catch (error) {
                console.error('Booking error:', error);
            }
        });
        
        // Load everything when page loads
        window.onload = loadEvents;
    </script>
</body>
</html>
